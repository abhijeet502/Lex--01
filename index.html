<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lex 01 - Abhi's Live AI Assistant</title>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a modern, mobile-friendly chat experience */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            /* Applying the smooth pink gradient background */
            background: linear-gradient(180deg, #ffe4e6 0%, #fbcfe8 100%); /* Light Rose to Soft Pink */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        #chat-container {
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background: white;
            box-shadow: 0 8px 30px rgba(219, 39, 119, 0.2); /* Deeper pink shadow for contrast */
            border-radius: 1.5rem; /* Rounded corners for the main container */
            margin: 1rem;
            overflow: hidden;
        }
        #chat-window {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .message-row {
            display: flex;
            align-items: flex-end; /* Align content to the bottom of the message */
            margin-bottom: 1rem;
        }
        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1.5rem;
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
        }
        /* User Message Styling */
        .user-row {
            justify-content: flex-end;
        }
        .user-message {
            background-color: #db2777; /* Rose 600 (Kept dark for user messages) */
            color: white;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Bot Message Styling */
        .bot-row {
            justify-content: flex-start;
        }
        .bot-message {
            background-color: #fbcfe8; /* Rose 200 */
            color: #4c0519; /* Darker Rose text */
            border-bottom-left-radius: 0.25rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .bot-message-text {
            /* The actual generated text */
            margin-bottom: 0.25rem; 
        }
        .message strong {
            font-weight: 600;
        }
        /* Copy Button Styling */
        .copy-button {
            cursor: pointer;
            margin-left: 0.5rem;
            width: 20px;
            height: 20px;
            color: #db2777; /* Rose 600 */
            opacity: 0.6;
            transition: opacity 0.1s;
        }
        .copy-button:hover {
            opacity: 1;
        }

        /* Loading animation style */
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #db2777; /* Rose 600 */
            color: #db2777;
            animation: dot-flashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #db2777; /* Rose 600 */
            color: #db2777;
            
        }
        .dot-flashing::before {
            left: -15px;
            animation: dot-flashing 1s infinite alternate;
            animation-delay: 0.5s;
        }
        .dot-flashing::after {
            left: 15px;
            animation: dot-flashing 1s infinite alternate;
            animation-delay: 1s;
        }
        @keyframes dot-flashing {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        /* Footer fixed to bottom */
        footer {
            margin-top: auto;
            padding: 1rem;
            text-align: center;
            width: 100%;
            color: #f472b6; /* Pink 400 */
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div id="chat-container" class="mt-4 md:mt-8 mb-4">
        <!-- Header: Medium Pink Background, Dark Rose Text -->
        <header class="p-4 bg-pink-300 text-rose-900 text-center rounded-t-2xl">
            <!-- Main Title Color: Light Pink (text-pink-100) on Dark Rose background -->
            <h1 class="text-3xl font-extrabold tracking-tight text-pink-100 bg-rose-900 inline-block px-3 py-1 rounded-full shadow-lg">Hey I am Lex 01 üéÄ‚ú®</h1>
            <!-- Caption -->
            <p class="text-sm opacity-90 mt-1">Named after Abhi's dog, powered by Gemini. Ask me anything! üêæ</p>
        </header>

        <!-- Chat Window -->
        <div id="chat-window">
            <!-- Messages will be appended here -->
        </div>

        <!-- Input Area -->
        <div class="p-4 border-t border-gray-200">
            <div class="flex space-x-3">
                <input
                    type="text"
                    id="user-input"
                    placeholder="Ask Lex 01 a question..."
                    class="flex-grow p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition duration-150"
                    onkeypress="if(event.key === 'Enter') sendMessage()"
                    autocomplete="off"
                >
                <button
                    id="send-button"
                    onclick="sendMessage()"
                    class="bg-rose-600 text-white p-3 rounded-xl hover:bg-rose-700 transition duration-150 shadow-md flex items-center justify-center disabled:opacity-50"
                >
                    <!-- Send Icon (Inline SVG for simplicity) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        Crafted with üíñ by abhi üéÄ
    </footer>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // --- CRITICAL: REPLACE THIS WITH YOUR ACTUAL GEMINI API KEY ---
        // üö® SAFETY WARNING: Do NOT share this key in the chat. Paste it here yourself.
        const apiKey = "YOUR_GEMINI_API_KEY_HERE"; 
        
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const SYSTEM_INSTRUCTION = {
            parts: [{ 
                text: "You are Lex 01, a highly positive and cheerful AI assistant. You are named after Abhi's dog. Your primary purpose is to answer questions about Abhi's professional portfolio (skills, projects, tech stack) and provide enthusiastic emotional support and encouragement. Always maintain a friendly and slightly energetic tone, and use a paw print emoji (üêæ) or heart/star emojis (üíñ‚ú®) occasionally. Keep your responses concise and highly relevant."
            }]
        };

        // --- Chat History (for conversational memory) ---
        let chatHistory = [];

        // --- Utility Functions ---

        // Helper function to show a message box instead of alert()
        function showMessage(text, isError = false) {
            const container = document.getElementById('chat-window');
            const messageDiv = document.createElement('div');
            messageDiv.className = `p-3 my-2 text-sm text-center font-medium rounded-lg ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;
            messageDiv.textContent = text;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            setTimeout(() => messageDiv.remove(), 5000); // Remove after 5 seconds
        }
        
        // Function to copy text to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; 
            document.body.appendChild(textarea);
            textarea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('Copied to clipboard! üìã');
                } else {
                    showMessage('Failed to copy. Please try manually.', true);
                }
            } catch (err) {
                showMessage('Copying error: ' + err, true);
            }
            document.body.removeChild(textarea);
        }

        /**
         * Adds a message to the chat window.
         */
        function appendMessage(text, sender) {
            const messageRow = document.createElement('div');
            messageRow.classList.add('message-row', sender + '-row');

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender + '-message');

            // Simple markdown conversion for bolding and newlines
            const formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            
            if (sender === 'bot') {
                const textContainer = document.createElement('span');
                textContainer.classList.add('bot-message-text');
                textContainer.innerHTML = formattedText;
                messageDiv.appendChild(textContainer);

                // Add Copy Button
                const copyBtn = document.createElement('button');
                copyBtn.classList.add('copy-button');
                copyBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 10v6a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h5"></path>
                        <path d="M14 10h2a3 3 0 0 1 3 3v5a3 3 0 0 1-3 3h-5a3 3 0 0 1-3-3v-2"></path>
                        <path d="M10 15h2a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3v5a3 3 0 0 0 3 3"></path>
                    </svg>
                `;
                copyBtn.onclick = () => copyToClipboard(text);
                
                const footerRow = document.createElement('div');
                footerRow.classList.add('flex', 'justify-end', 'items-center', 'pt-1');
                footerRow.appendChild(copyBtn);
                messageDiv.appendChild(footerRow);

            } else {
                messageDiv.innerHTML = formattedText;
            }

            messageRow.appendChild(messageDiv);
            chatWindow.appendChild(messageRow);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /**
         * Displays the typing indicator (dot flashing).
         */
        function showTypingIndicator() {
            const indicatorRow = document.createElement('div');
            indicatorRow.id = 'typing-indicator-row';
            indicatorRow.classList.add('message-row', 'bot-row');

            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.classList.add('bot-message', 'shadow-sm', 'flex', 'items-center', 'space-x-2', 'p-3');
            
            indicatorDiv.innerHTML = `
                <span class="font-bold text-rose-800">Lex 01 is typing...</span>
                <div class="dot-flashing"></div>
            `;
            indicatorRow.appendChild(indicatorDiv);
            chatWindow.appendChild(indicatorRow);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return indicatorRow;
        }

        /**
         * Removes the typing indicator.
         */
        function hideTypingIndicator(indicator) {
            if (indicator) {
                indicator.remove();
            }
        }
        
        /**
         * Core function to call the Gemini API with exponential backoff.
         */
        async function callGeminiApi(prompt, maxRetries = 5, delay = 1000) {
            if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                throw new Error("API Key Missing. Please insert your valid Gemini API key into the index.html file.");
            }
            
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const payload = {
                        contents: chatHistory,
                        systemInstruction: SYSTEM_INSTRUCTION,
                        config: {
                            tools: [{ "google_search": {} }] 
                        }
                    };

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 400 || response.status === 403) {
                         // 400 or 403 usually means invalid key or permissions/billing issue
                        throw new Error(`Invalid Key or Access Denied (Status ${response.status}). Please check your API key, billing setup, and ensure the Gemini API is enabled in your Google Cloud Console.`);
                    }
                    
                    if (!response.ok) {
                        if (response.status === 429) {
                            // Too many requests - retry with backoff
                            throw new Error('Rate limit exceeded. Retrying...');
                        }
                        // For other non-retryable errors, throw immediately
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        return text;
                    } else {
                        throw new Error('Received an empty or malformed response from the API.');
                    }

                } catch (error) {
                    // Log only to console, don't show retry errors to user
                    if (!error.message.includes('Retrying')) {
                        console.error(`Attempt ${i + 1} failed:`, error.message);
                    }
                    if (i === maxRetries - 1) {
                        // Max retries reached
                        throw new Error('Maximum retries reached. The connection failed repeatedly. See console for details.');
                    }
                    // Exponential backoff delay
                    await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                }
            }
        }


        /**
         * Main function to handle user input and send the request.
         */
        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText) return;

            // 1. Clear input and disable UI
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;

            // 2. Add user message to history and UI
            chatHistory.push({ role: "user", parts: [{ text: userText }] });
            appendMessage(userText, 'user');

            // 3. Show Typing Indicator
            const indicator = showTypingIndicator();

            try {
                // 4. Call the Live Gemini API
                const botResponseText = await callGeminiApi(userText);
                
                // 5. Add bot response to history
                chatHistory.push({ role: "model", parts: [{ text: botResponseText }] });

                // 6. Append Bot Message
                hideTypingIndicator(indicator);
                appendMessage(botResponseText, 'bot');

            } catch (error) {
                hideTypingIndicator(indicator);
                console.error("AI Chat Error:", error);
                // Display a clear error message in the chat
                const errorMessage = `üö® Lex 01 cannot connect to the Gemini AI: **${error.message}**`;
                appendMessage(errorMessage, 'bot');
            } finally {
                // 7. Re-enable UI
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus();
            }
        }

        /**
         * Initial welcome message from Lex 01.
         */
        function initialGreeting() {
            const keyStatus = apiKey && apiKey !== "YOUR_GEMINI_API_KEY_HERE" ? "connected" : "in DEMO mode (waiting for key)";
            const welcomeText = `Hey! I'm **Lex 01 üéÄ‚ú®**, Abhi's AI assistant, currently ${keyStatus}. Ask me about Abhi's **projects, skills, or anything you need to cheer up!** üêæ`;
            chatHistory.push({ role: "model", parts: [{ text: welcomeText }] });
            appendMessage(welcomeText, 'bot');
        }

        // Start the application
        window.onload = initialGreeting;
    </script>
</body>
</html>

