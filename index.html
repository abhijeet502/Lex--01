<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lex 01 - Abhi's AI Assistant</title>
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
body { font-family:'Inter',sans-serif; background:linear-gradient(180deg,#ffe4e6 0%,#fbcfe8 100%); display:flex; flex-direction:column; align-items:center; min-height:100vh; }
#chat-container { max-width:600px;width:100%;display:flex;flex-direction:column;flex-grow:1;background:white;box-shadow:0 8px 30px rgba(219,39,119,0.2);border-radius:1.5rem;margin:1rem;overflow:hidden; }
#chat-window { flex-grow:1;padding:1.5rem;overflow-y:auto;scroll-behavior:smooth; }
.message-row { display:flex; align-items:flex-end; margin-bottom:1rem; }
.message { max-width:85%; padding:0.75rem 1rem; border-radius:1.5rem; line-height:1.5; word-wrap:break-word; position:relative; }
.user-row { justify-content:flex-end; }
.user-message { background-color:#db2777;color:white;border-bottom-right-radius:0.25rem; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.bot-row { justify-content:flex-start; }
.bot-message { background-color:#fbcfe8;color:#4c0519;border-bottom-left-radius:0.25rem; box-shadow:0 1px 3px rgba(0,0,0,0.05); display:flex; flex-direction:column; }
/* Ensure bolding works inside the message */
.message strong { font-weight: 700; } 
.copy-button { cursor:pointer; margin-left:0.5rem; width:20px; height:20px; color:#db2777; opacity:0.6; transition:opacity 0.1s; }
.copy-button:hover { opacity:1; }
/* Dot flashing animation styles */
.dot-flashing { position:relative;width:10px;height:10px;border-radius:5px;background-color:#db2777; animation:dot-flashing 1s infinite alternate; }
.dot-flashing::before,.dot-flashing::after{content:'';display:inline-block;position:absolute;top:0;width:10px;height:10px;border-radius:5px;background-color:#db2777;}
.dot-flashing::before{left:-15px;animation-delay:0.5s;}
.dot-flashing::after{left:15px;animation-delay:1s;}
@keyframes dot-flashing{0%{opacity:0.5;}100%{opacity:1;}}
footer{margin-top:auto;padding:1rem;text-align:center;width:100%;color:#f472b6;font-size:0.875rem;}
</style>
</head>
<body class="min-h-screen flex flex-col items-center">

<div id="chat-container" class="mt-4 md:mt-8 mb-4">
    <header class="p-4 bg-pink-300 text-rose-900 text-center rounded-t-2xl">
        <h1 class="text-3xl font-extrabold tracking-tight text-pink-100 bg-rose-900 inline-block px-3 py-1 rounded-full shadow-lg">Hey I am Lex 01 üéÄ‚ú®</h1>
        <p class="text-sm opacity-90 mt-1" id="subheader-text">Named after Abhi's dog, powered by AI. Ask me anything! üêæ</p>
    </header>
    <div id="chat-window"></div>
    <div class="p-4 border-t border-gray-200">
        <div class="flex space-x-3">
            <input type="text" id="user-input" placeholder="Ask Lex 01 a question..." class="flex-grow p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition duration-150" autocomplete="off">
            <button id="send-button" class="bg-rose-600 text-white p-3 rounded-xl hover:bg-rose-700 transition duration-150 shadow-md flex items-center justify-center disabled:opacity-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>
</div>

<footer>Crafted with üíñ by abhi üéÄ</footer>

<script>
    const chatWindow = document.getElementById('chat-window');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    
    // --- UPDATED API ENDPOINT ---
    const API_URL = "https://api.aiproxy.io/api/gpt4free";
    
    // --- Utility Functions (Same as previous) ---

    function appendMessage(text, sender) {
        const row = document.createElement('div');
        row.classList.add('message-row', sender + '-row');
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', sender + '-message');

        const formattedText = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\n/g, '<br>');
        
        if (sender === 'bot') {
            const textContainer = document.createElement('span');
            textContainer.innerHTML = formattedText;
            msgDiv.appendChild(textContainer);

            const copyBtn = document.createElement('button');
            copyBtn.classList.add('copy-button');
            copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 10v6a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h5"></path>
                    <path d="M14 10h2a3 3 0 0 1 3 3v5a3 3 0 0 1-3 3h-5a3 3 0 0 1-3-3v-2"></path>
                    <path d="M10 15h2a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3v5a3 3 0 0 0 3 3"></path>
                </svg>
            `;
            copyBtn.onclick = () => console.log('Copy functionality not implemented yet.'); 
            
            const footerRow = document.createElement('div');
            footerRow.classList.add('flex', 'justify-end', 'items-center', 'pt-1');
            footerRow.appendChild(copyBtn);
            msgDiv.appendChild(footerRow);
        } else {
            msgDiv.innerHTML = formattedText;
        }

        row.appendChild(msgDiv);
        chatWindow.appendChild(row);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function showTyping() {
        const row = document.createElement('div');
        row.id = 'typing-indicator-row';
        row.classList.add('message-row', 'bot-row');
        const div = document.createElement('div');
        div.classList.add('bot-message', 'flex', 'items-center', 'space-x-2', 'p-3');
        div.innerHTML = `<span class="font-bold text-rose-800">Lex 01 is typing...</span><div class="dot-flashing"></div>`;
        row.appendChild(div);
        chatWindow.appendChild(row);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        return row;
    }
    
    function hideTyping(row) { 
        if(row) row.remove(); 
    }
    
    // --- UPDATED API CALL FUNCTION ---

    /**
     * Calls the external GPT4Free API using a POST request.
     */
    async function callFreeGPTApi(userText) {
        // We include a persona prompt in the query for better results
        const personaPrompt = `Act as Lex 01, Abhi's highly positive AI assistant. Your responses must be concise and relate to Abhi's professional portfolio (skills, projects, tech stack) or provide cheerful support. Always use the üêæ emoji occasionally. User query: ${userText}`;
        
        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    // The API expects the content in the 'prompt' field
                    prompt: personaPrompt 
                })
            });
            
            let data;
            try {
                // The API should return JSON with a 'response' field
                data = await res.json();
            } catch(e) {
                throw new Error('Received non-JSON response from AI service.');
            }

            if (!res.ok) {
                // If the status is 4xx or 5xx, throw the error provided by the API
                throw new Error(data.error || `API error with status ${res.status}.`);
            }
            
            // Check for the expected response field
            // FIX: Ensure we check for data.response as per API suggestion
            return data.response || 'No specific response content was returned.';

        } catch(err) {
            throw new Error(err.message || 'Network failed or API service is down.');
        }
    }

    /**
     * Main function to handle user input and API call.
     */
    async function sendMessage() {
        const userText = userInput.value.trim();
        if (!userText) return;

        userInput.value = ''; 
        userInput.disabled = true; 
        sendButton.disabled = true;

        // Display user message
        appendMessage(userText, 'user');
        
        // Show typing indicator
        const typing = showTyping();

        try {
            const botResp = await callFreeGPTApi(userText);
            hideTyping(typing);
            appendMessage(botResp, 'bot');
        } catch(err) {
            hideTyping(typing);
            console.error("API Call Error:", err);
            // Display error to the user
            appendMessage(`üö® Lex 01 cannot connect: **${err.message}**. This free API may be down. Please try again later.`,'bot');
        } finally {
            // Re-enable input
            userInput.disabled = false; 
            sendButton.disabled = false; 
            userInput.focus();
        }
    }

    /**
     * Initial message display on page load.
     */
    function initialGreeting() {
        // Display the required welcome message immediately
        appendMessage(`Hey! I'm **Lex 01 üéÄ‚ú®**, Abhi's AI assistant! Ask me about Abhi's projects, skills, or anything! üêæ`,'bot');
    }

    // --- Event Listeners ---
    userInput.addEventListener('keypress', function(event) {
        // Call sendMessage() when 'Enter' key is pressed
        if (event.key === 'Enter') sendMessage();
    });
    
    // Call sendMessage() when the send button is clicked
    sendButton.addEventListener('click', sendMessage);

    // Start the application after the document loads
    window.onload = initialGreeting;
</script>
</body>
</html>

